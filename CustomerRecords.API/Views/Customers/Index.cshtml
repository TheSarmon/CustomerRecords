@{
    ViewData["Title"] = "Employee Page";
}

<div class="row">
    <div class="col-md-4">
        <div class="row" style="display:none;">
            <div class="col-md-4">
                <label>Id:</label>
            </div>
            <div class="col-md-8">
                <input id="txtCustomerId" class="inputField" style="width:100%;" placeholder="Id"/>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <label>First Name:</label>
            </div>
            <div class="col-md-8">
                <input id="txtFirstName" class="inputField" type="text" style="width:100%;" placeholder="John"></input>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <label>Last Name:</label>
            </div>
            <div class="col-md-8">
                <input id="txtLastName" class="inputField" style="width:100%;" placeholder="Doe" />
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <label>Phone Number:</label>
            </div>
            <div class="col-md-8">
                <input id="txtPhoneNumber" class="inputField" type="number" style="width:100%;" placeholder="0931234567" />
            </div>
        </div>
         <div class="row">
            <div class="col-md-4">
                <label>Address:</label>
            </div>
            <div class="col-md-8">
                <input id="txtAddress" class="inputField" type="text" style="width:100%;" placeholder="Lviv" />
            </div>
        </div>
        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-8">
                <button class="btn btn-primary" onclick="Save()">Save</button>
                <button class="btn btn-danger" onclick="Reset()" style="float:right;">Reset</button>
            </div>
        </div>
    </div>
    <div class="col-md-8">
        <table id="tblCustomer" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Customer Id</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Phone Number</th>
                    <th>Address</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script src="~/jquery/jquery.min.js"></script>
<script type="text/javascript">
    var _customers = [];
    $(document).ready(function () {
        LoadCustomers();
    });
    function LoadCustomers() {
        Reset();
        $("#tblCustomer tbody").empty();

        $.get("../Customers/GetCustomers", function (customers) {
            _customers = customers;
            $.map(customers, function (customer) {
                var tempStr = "<tr>";
                tempStr += "<td>"  + customer.id + "</td>";
                tempStr += "<td>" + customer.firstName + "</td>";
                tempStr += "<td>" + customer.lastName + "</td>";
                tempStr += "<td>" + customer.phoneNumber + "</td>";
                tempStr += "<td>" + customer.address + "</td>";
                //tempStr += "<td><button class= 'btn btn-primary' onclick='Edit(\"" + customer.id + "\")'>Edit</button><button class='btn btn-danger' onclick='Delete(\"" + customer.id + "\")'>Delete</button>
                tempStr += "<td><button class='btn btn-primary' onclick='Edit(\"" + customer.id + "\")'>Edit</button><button class='btn btn-danger' onclick='Delete(\"" + customer.id + "\")'>Delete</button>";
                tempStr += "</tr>";
                $("#tblCustomer tbody").append(tempStr);
            });
        });
    }

    function Reset(){
        _customers = [];
        $(".inputField").val("");
    }

    function Save() {
        var customer = {
            id: $.trim($("#txtCustomerId").val()),
            FirstName: $.trim($("#txtFirstName").val()),
            LastName: $.trim($("#txtLastName").val()),
            PhoneNumber: $.trim($("#txtPhoneNumber").val()),
            Address: $.trim($("#txtAddress").val())
        };
        $.post("../Customers/CreateCustomer", customer, function (cust) {
            LoadCustomers();
        });
    }

    function Edit(customerId) {
        var customer = _customers.find(c => c.id == customerId);
        $("#txtCustomerId").val(customer.id);
        $("#txtFirstName").val(customer.firstName);
        $("#txtLastName").val(customer.lastName);
        $("#txtPhoneNumber").val(customer.phoneNumber);
        $("#txtAddress").val(customer.address);
    }

    function Delete(customerId) {
        $.ajax({
            url: "../Customers/DeleteCustomer?customerId=" + customerId,
            method: 'DELETE'
        })
            .done(function (data) {
                alert(data);
                LoadCustomers();
            });
    }
</script>